{"ast":null,"code":"import _createClass from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _classCallCheck from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";var Visualizer=/*#__PURE__*/_createClass(function Visualizer(_ref){var _this=this;var draw=_ref.draw,size=_ref.size,volume=_ref.volume;_classCallCheck(this,Visualizer);this.source=void 0;this.count=void 0;this.ac=void 0;this.size=void 0;this.gainNode=void 0;this.analyser=void 0;this.rafId=void 0;this.draw=void 0;this.load=function(url,callback){var xhr=new XMLHttpRequest();xhr.abort();xhr.open(\"GET\",url);xhr.responseType=\"arraybuffer\";xhr.onload=function(){callback(xhr.response);};xhr.send();};this.play=function(src,start){var n=++_this.count;_this.source&&_this.source.stop();var decodeCallback=function decodeCallback(buffer){if(n!==_this.count)return;var bufferSource=_this.ac.createBufferSource();// AudioBuffer数据赋值给buffer属性\nbufferSource.buffer=buffer;bufferSource.connect(_this.analyser);bufferSource.loop=true;bufferSource.start(_this.ac.currentTime,start,(buffer===null||buffer===void 0?void 0:buffer.duration)-start);_this.source=bufferSource;_this.visualize();};if(src instanceof ArrayBuffer){_this.ac.decodeAudioData(src,decodeCallback);}else{_this.load(src,function(arrayBuffer){_this.ac.decodeAudioData(arrayBuffer,decodeCallback);});}};this.updateVolume=function(vol){_this.gainNode.gain.value=vol;};this.visualize=function(){// 用于存放音频数据的数组，长度是fftsize的一半\nvar arr=new Uint8Array(_this.analyser.frequencyBinCount);var raf=window.requestAnimationFrame;var fn=function fn(){// 将音频频域数据复制到传入的Uint8Array数组\n_this.analyser.getByteFrequencyData(arr);_this.draw(arr);//频域作为参数传入绘制函数draw\n_this.rafId=raf(fn);};fn();};this.pause=function(){_this.ac.suspend();window.cancelAnimationFrame(_this.rafId);};this.resume=function(){_this.ac.resume();_this.visualize();};this.stop=function(){_this.ac.close();window.cancelAnimationFrame(_this.rafId);};this.source=null;this.count=0;this.ac=new window.AudioContext();this.draw=draw;this.size=size;this.rafId=0;this.gainNode=this.ac.createGain();this.gainNode.gain.value=volume;this.gainNode.connect(this.ac.destination);this.analyser=this.ac.createAnalyser();this.analyser.fftSize=this.size*2;this.analyser.connect(this.gainNode);});export{Visualizer as default};","map":{"version":3,"names":["Visualizer","draw","size","volume","source","count","ac","gainNode","analyser","rafId","load","url","callback","xhr","XMLHttpRequest","abort","open","responseType","onload","response","send","play","src","start","n","stop","decodeCallback","buffer","bufferSource","createBufferSource","connect","loop","currentTime","duration","visualize","ArrayBuffer","decodeAudioData","arrayBuffer","updateVolume","vol","gain","value","arr","Uint8Array","frequencyBinCount","raf","window","requestAnimationFrame","fn","getByteFrequencyData","pause","suspend","cancelAnimationFrame","resume","close","AudioContext","createGain","destination","createAnalyser","fftSize"],"sources":["/Users/evik/kl/project-2024/klasmart-assessment-frontend/src/components/AuduiVision/visualizer.ts"],"sourcesContent":["interface VisualizerProps {\n  draw: any;\n  size: any;\n  volume: any;\n}\nexport default class Visualizer {\n  source: any;\n  count: number;\n  ac: AudioContext;\n  size: any;\n  gainNode: GainNode;\n  analyser: AnalyserNode;\n  rafId: number;\n  draw: any;\n  constructor({ draw, size, volume }: VisualizerProps) {\n    this.source = null;\n    this.count = 0;\n    this.ac = new window.AudioContext();\n    this.draw = draw;\n    this.size = size;\n    this.rafId = 0;\n\n    this.gainNode = this.ac.createGain();\n    this.gainNode.gain.value = volume;\n    this.gainNode.connect(this.ac.destination);\n    this.analyser = this.ac.createAnalyser();\n    this.analyser.fftSize = this.size * 2;\n    this.analyser.connect(this.gainNode);\n  }\n\n  load = (url: string | URL, callback: { (arrayBuffer: any): void; (arg0: any): void }) => {\n    const xhr = new XMLHttpRequest();\n    xhr.abort();\n    xhr.open(\"GET\", url);\n    xhr.responseType = \"arraybuffer\";\n    xhr.onload = () => {\n      callback(xhr.response);\n    };\n    xhr.send();\n  };\n\n  play = (src: string | URL | ArrayBuffer, start: number) => {\n    const n = ++this.count;\n    this.source && this.source.stop();\n    const decodeCallback = (buffer: AudioBuffer | null) => {\n      if (n !== this.count) return;\n      const bufferSource: AudioBufferSourceNode = this.ac.createBufferSource();\n      // AudioBuffer数据赋值给buffer属性\n      bufferSource.buffer = buffer;\n      bufferSource.connect(this.analyser);\n      bufferSource.loop = true;\n      bufferSource.start(this.ac.currentTime, start, (buffer?.duration as number) - start)\n      this.source = bufferSource;\n      this.visualize();\n    };\n    if (src instanceof ArrayBuffer) {\n      this.ac.decodeAudioData(src, decodeCallback);\n    } else {\n      this.load(src, (arrayBuffer) => {\n        this.ac.decodeAudioData(arrayBuffer, decodeCallback);\n      });\n    }\n  };\n\n  updateVolume = (vol: number) => {\n    this.gainNode.gain.value = vol;\n  };\n\n  visualize = () => {\n    // 用于存放音频数据的数组，长度是fftsize的一半\n    const arr = new Uint8Array(this.analyser.frequencyBinCount);\n    const raf = window.requestAnimationFrame;\n    const fn = () => {\n      // 将音频频域数据复制到传入的Uint8Array数组\n      this.analyser.getByteFrequencyData(arr);\n      this.draw(arr); //频域作为参数传入绘制函数draw\n      this.rafId = raf(fn);\n    };\n    fn();\n  };\n\n  pause = () => {\n    this.ac.suspend();\n    window.cancelAnimationFrame(this.rafId);\n  };\n\n  resume = () => {\n    this.ac.resume();\n    this.visualize();\n  };\n\n  stop = () => {\n    this.ac.close();\n    window.cancelAnimationFrame(this.rafId);\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}