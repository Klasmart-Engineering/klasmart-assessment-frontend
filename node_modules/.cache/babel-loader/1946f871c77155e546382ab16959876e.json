{"ast":null,"code":"import _slicedToArray from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createStyles,makeStyles,Slider}from\"@material-ui/core\";import PauseCircleFilledIcon from\"@material-ui/icons/PauseCircleFilled\";import PlayCircleFilledOutlinedIcon from\"@material-ui/icons/PlayCircleFilledOutlined\";import{useEffect,useReducer,useRef,useState}from\"react\";import getDrawMethod from\"./draw\";import Visualizer from\"./visualizer\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return createStyles({progress:{flex:1,marginLeft:\"10px\",marginRight:\"10px\",color:\"#0E78D5\"},itemTool:{cursor:\"pointer\",color:\"#0E78D5\"},tools:{width:\"100%\",display:\"flex\",justifyContent:\"space-around\"}});});export var AudioVision=function AudioVision(props){var css=useStyles();var src=props.src,bars=props.bars,barColor=props.barColor,height=props.height,width=props.width,volume=props.volume;var _useState=useState(),_useState2=_slicedToArray(_useState,2),visualizer=_useState2[0],setVisualize=_useState2[1];var canvasRef=useRef(null);var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),pauseTime=_useState4[0],setPauseTime=_useState4[1];var _useReducer=useReducer(function(){return true;},false),_useReducer2=_slicedToArray(_useReducer,2),loaded=_useReducer2[0],dispatchLoaded=_useReducer2[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),value=_useState6[0],setValue=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isplay=_useState8[0],setIsplay=_useState8[1];var audioRef=useRef(null);useEffect(function(){if(loaded){var _canvasRef$current;var ctx=(_canvasRef$current=canvasRef.current)===null||_canvasRef$current===void 0?void 0:_canvasRef$current.getContext(\"2d\");var param={ctx:ctx,height:height,width:width,bars:bars,barColor:barColor};var visu=new Visualizer({size:bars,draw:getDrawMethod(param),volume:volume});setVisualize(visu);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[loaded]);useEffect(function(){return function(){visualizer&&visualizer.stop();};},[visualizer]);var handleChange=function handleChange(event,newValue){var audio=audioRef.current;if(!audio)return;setValue(newValue);audio.currentTime=audio.duration*newValue*0.01;if(isplay){visualizer===null||visualizer===void 0?void 0:visualizer.play(src,audio.currentTime);}};var handlePlay=function handlePlay(){var audio=audioRef.current;if(!audio)return;setIsplay(!isplay);if(isplay){setPauseTime(audio.currentTime);audio.pause();visualizer===null||visualizer===void 0?void 0:visualizer.pause();}else{audio.play();if(audio.currentTime===0){visualizer===null||visualizer===void 0?void 0:visualizer.play(src,audio.currentTime);}else{if(Math.abs(audio.currentTime-pauseTime)<0.0003){visualizer===null||visualizer===void 0?void 0:visualizer.resume();}else{visualizer===null||visualizer===void 0?void 0:visualizer.resume();visualizer===null||visualizer===void 0?void 0:visualizer.play(src,audio.currentTime);}}}};var handleTimeUpdate=function handleTimeUpdate(){var audio=audioRef.current;if(audio){if(!Number.isFinite(audio===null||audio===void 0?void 0:audio.duration)){audio.currentTime=Number.MAX_SAFE_INTEGER;audio.currentTime=0;}else{setValue(audio.currentTime/audio.duration*100);}if(Number(audio===null||audio===void 0?void 0:audio.currentTime)>=audio.duration){setIsplay(false);}}};var handleOnCanPlay=function handleOnCanPlay(){var audio=audioRef.current;if(audio){if(!Number.isFinite(audio===null||audio===void 0?void 0:audio.duration)){audio.currentTime=Number.MAX_SAFE_INTEGER;audio.currentTime=0;}else{dispatchLoaded();}}};return/*#__PURE__*/_jsxs(\"div\",{children:[!loaded&&/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"}),loaded&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,width:width,height:height}),/*#__PURE__*/_jsxs(\"div\",{className:css.tools,children:[/*#__PURE__*/_jsx(Slider,{className:css.progress,value:value,onChange:handleChange,\"aria-labelledby\":\"continuous-slider\"}),isplay?/*#__PURE__*/_jsx(PauseCircleFilledIcon,{className:css.itemTool,onClick:handlePlay}):/*#__PURE__*/_jsx(PlayCircleFilledOutlinedIcon,{className:css.itemTool,onClick:handlePlay})]})]}),/*#__PURE__*/_jsx(\"audio\",{id:\"audio\",muted:true,src:src,onCanPlay:handleOnCanPlay,onTimeUpdate:handleTimeUpdate,ref:audioRef})]});};","map":{"version":3,"names":["createStyles","makeStyles","Slider","PauseCircleFilledIcon","PlayCircleFilledOutlinedIcon","useEffect","useReducer","useRef","useState","getDrawMethod","Visualizer","useStyles","theme","progress","flex","marginLeft","marginRight","color","itemTool","cursor","tools","width","display","justifyContent","AudioVision","props","css","src","bars","barColor","height","volume","visualizer","setVisualize","canvasRef","pauseTime","setPauseTime","loaded","dispatchLoaded","value","setValue","isplay","setIsplay","audioRef","ctx","current","getContext","param","visu","size","draw","stop","handleChange","event","newValue","audio","currentTime","duration","play","handlePlay","pause","Math","abs","resume","handleTimeUpdate","Number","isFinite","MAX_SAFE_INTEGER","handleOnCanPlay"],"sources":["/Users/evik/kl/project-2024/klasmart-assessment-frontend/src/components/AuduiVision/AudioVision.tsx"],"sourcesContent":["import { createStyles, makeStyles, Slider } from \"@material-ui/core\";\nimport PauseCircleFilledIcon from \"@material-ui/icons/PauseCircleFilled\";\nimport PlayCircleFilledOutlinedIcon from \"@material-ui/icons/PlayCircleFilledOutlined\";\nimport { useEffect, useReducer, useRef, useState } from \"react\";\nimport getDrawMethod from \"./draw\";\nimport Visualizer from \"./visualizer\";\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    progress: {\n      flex: 1,\n      marginLeft: \"10px\",\n      marginRight: \"10px\",\n      color: \"#0E78D5\",\n    },\n    itemTool: {\n      cursor: \"pointer\",\n      color: \"#0E78D5\",\n    },\n    tools: {\n      width: \"100%\",\n      display: \"flex\",\n      justifyContent: \"space-around\",\n    },\n  })\n);\nexport interface AudioVisionProps {\n  src: string;\n  bars: number;\n  barColor: string[];\n  height: number;\n  width: number;\n  volume: number;\n}\nexport const AudioVision = (props: AudioVisionProps) => {\n  const css = useStyles();\n  const { src, bars, barColor, height, width, volume } = props;\n  const [visualizer, setVisualize] = useState<Visualizer>();\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [pauseTime, setPauseTime] = useState<number>(0);\n  const [loaded, dispatchLoaded] = useReducer(() => true, false);\n  const [value, setValue] = useState<number>(0);\n  const [isplay, setIsplay] = useState<boolean>(false);\n  const audioRef = useRef<HTMLAudioElement>(null);\n\n  useEffect(() => {\n    if (loaded) {\n      const ctx = canvasRef.current?.getContext(\"2d\");\n      const param = { ctx, height, width, bars, barColor };\n      const visu = new Visualizer({\n        size: bars,\n        draw: getDrawMethod(param),\n        volume,\n      });\n      setVisualize(visu);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaded]);\n\n  useEffect(() => {\n    return () => {\n      visualizer && visualizer.stop();\n    };\n  }, [visualizer]);\n\n  const handleChange = (event: any, newValue: number | number[]) => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    setValue(newValue as number);\n    audio.currentTime = audio.duration * (newValue as number) * 0.01;\n    if (isplay) {\n      visualizer?.play(src, audio.currentTime);\n    }\n  };\n\n  const handlePlay = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    setIsplay(!isplay);\n    if (isplay) {\n      setPauseTime(audio.currentTime);\n      audio.pause();\n      visualizer?.pause();\n    } else {\n      audio.play();\n      if (audio.currentTime === 0) {\n        visualizer?.play(src, audio.currentTime);\n      } else {\n        if (Math.abs(audio.currentTime - pauseTime) < 0.0003) {\n          visualizer?.resume();\n        } else {\n          visualizer?.resume();\n          visualizer?.play(src, audio.currentTime);\n        }\n      }\n    }\n  };\n\n  const handleTimeUpdate = () => {\n    const audio = audioRef.current;\n    if (audio) {\n      if (!Number.isFinite(audio?.duration)) {\n        audio.currentTime = Number.MAX_SAFE_INTEGER;\n        audio.currentTime = 0;\n      } else {\n        setValue((audio.currentTime / audio.duration) * 100);\n      }\n      if (Number(audio?.currentTime) >= audio.duration) {\n        setIsplay(false);\n      }\n    }\n  };\n\n  const handleOnCanPlay = () => {\n    const audio = audioRef.current;\n    if (audio) {\n      if (!Number.isFinite(audio?.duration)) {\n        audio.currentTime = Number.MAX_SAFE_INTEGER;\n        audio.currentTime = 0;\n      } else {\n        dispatchLoaded();\n      }\n    }\n  };\n  return (\n    <div>\n      {!loaded && <p>Loading...</p>}\n      {loaded && (\n        <>\n          <canvas ref={canvasRef} width={width} height={height} />\n          <div className={css.tools}>\n            <Slider className={css.progress} value={value} onChange={handleChange} aria-labelledby=\"continuous-slider\" />\n            {isplay ? (\n              <PauseCircleFilledIcon className={css.itemTool} onClick={handlePlay} />\n            ) : (\n              <PlayCircleFilledOutlinedIcon className={css.itemTool} onClick={handlePlay} />\n            )}\n          </div>\n        </>\n      )}\n      <audio id=\"audio\" muted src={src} onCanPlay={handleOnCanPlay} onTimeUpdate={handleTimeUpdate} ref={audioRef} />\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}