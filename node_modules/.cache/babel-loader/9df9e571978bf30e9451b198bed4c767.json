{"ast":null,"code":"import _asyncToGenerator from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _createForOfIteratorHelper from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _regeneratorRuntime from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/regenerator/index.js\";import mitt from\"mitt\";import{createIntl,createIntlCache}from\"react-intl\";import{apiLocaleInCookie}from\"../api/extra\";import{shouldBeLangName}from\"./lang/type\";var AVAILABLE_LANGUAGES=[\"en\",\"zh\",\"vi\",\"ko\",\"id\",\"es\",\"th\"];function getDefaultLocale(availableLanguages){var languages=navigator.languages||[navigator.language,navigator.browserLanguage,navigator.userLanguage,navigator.systemLanguage];var _iterator=_createForOfIteratorHelper(languages),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var language=_step.value;var locale=language.slice(0,2);if(availableLanguages.includes(locale))return locale;}}catch(err){_iterator.e(err);}finally{_iterator.f();}return\"en\";}function getLocaleFromUrl(){var url=new URL(window.location.href);return url.searchParams.get(\"iso\");}function getValueNamesByDescription(description){var result=description.match(/{.*?}/g);if(result==null)return;return result.map(function(x){return x.slice(1,-1);});}var LocaleManager=/*#__PURE__*/function(){function LocaleManager(locale){_classCallCheck(this,LocaleManager);this.intl=void 0;this.emitter=mitt();this.toggle(locale);}_createClass(LocaleManager,[{key:\"toggle\",value:function(){var _toggle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(locale){var _yield$import,messages,cache;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return import(\"./lang/\".concat(locale,\".json\"));case 2:_yield$import=_context.sent;messages=_yield$import.default;cache=createIntlCache();this.intl=createIntl({locale:locale,messages:messages},cache);this.emitter.emit(\"change\",this.intl);case 7:case\"end\":return _context.stop();}}},_callee,this);}));function toggle(_x){return _toggle.apply(this,arguments);}return toggle;}()},{key:\"getLocale\",value:function getLocale(){var _this$intl,_this$intl2;if(!((_this$intl=this.intl)!==null&&_this$intl!==void 0&&_this$intl.locale))return;return shouldBeLangName((_this$intl2=this.intl)===null||_this$intl2===void 0?void 0:_this$intl2.locale);}},{key:\"reportMiss\",value:function reportMiss(description,id,values){var valueNames=getValueNamesByDescription(description);if(!valueNames){if(values){}return description;}if(!values){return description;}var providedValueNames=Object.keys(values);if(providedValueNames.sort().toString()!==valueNames.sort().toString()){}// let result = description;\nreturn providedValueNames.reduce(function(result,name){return result.replace(new RegExp(\"\\\\{\".concat(name,\"\\\\}\"),\"g\"),String(values[name]));},description);}},{key:\"dscribe\",value:function dscribe(desc){var _this=this;var formatMessage=function formatMessage(id,values){return _this.formatMessage(id,values);};return{t:formatMessage};}},{key:\"formatMessage\",value:function formatMessage(id,values){if(!this.intl)return id;return this.intl.formatMessage({id:id},values);}},{key:\"on\",value:function on(event,handler){this.emitter.on(\"change\",handler);}}]);return LocaleManager;}();var defaultLocale=getLocaleFromUrl()||apiLocaleInCookie()||getDefaultLocale(AVAILABLE_LANGUAGES);export var localeManager=new LocaleManager(shouldBeLangName(defaultLocale));export var t=localeManager.formatMessage.bind(localeManager);export var d=localeManager.dscribe.bind(localeManager);export var reportMiss=localeManager.reportMiss.bind(localeManager);","map":{"version":3,"names":["mitt","createIntl","createIntlCache","apiLocaleInCookie","shouldBeLangName","AVAILABLE_LANGUAGES","getDefaultLocale","availableLanguages","languages","navigator","language","browserLanguage","userLanguage","systemLanguage","locale","slice","includes","getLocaleFromUrl","url","URL","window","location","href","searchParams","get","getValueNamesByDescription","description","result","match","map","x","LocaleManager","intl","emitter","toggle","messages","default","cache","emit","id","values","valueNames","providedValueNames","Object","keys","sort","toString","reduce","name","replace","RegExp","String","desc","formatMessage","t","event","handler","on","defaultLocale","localeManager","bind","d","dscribe","reportMiss"],"sources":["/Users/evik/kl/project-2024/klasmart-assessment-frontend/src/locale/LocaleManager.ts"],"sourcesContent":["import mitt from \"mitt\";\nimport { createIntl, createIntlCache, IntlFormatters, IntlShape } from \"react-intl\";\nimport { apiLocaleInCookie } from \"../api/extra\";\nimport {\n  LangeRecordValuesByDesc,\n  LangeRecordValuesById,\n  LangName,\n  LangRecodeDescription,\n  LangRecordId,\n  LangRecordIdByDescription,\n  shouldBeLangName,\n} from \"./lang/type\";\n\ntype FormatMessageReturn = ReturnType<IntlFormatters<string>[\"formatMessage\"]>;\ntype FormatMessageByDescription<Desc extends LangRecodeDescription> = LangeRecordValuesByDesc<Desc> extends undefined\n  ? {\n      (id: LangRecordIdByDescription<Desc>): FormatMessageReturn;\n    }\n  : {\n      <Id extends LangRecordIdByDescription<Desc>>(id: Id, values: LangeRecordValuesById<Id>): FormatMessageReturn;\n    };\n\nconst AVAILABLE_LANGUAGES = [\"en\", \"zh\", \"vi\", \"ko\", \"id\", \"es\", \"th\"];\n\nfunction getDefaultLocale(availableLanguages: string[]) {\n  const languages = navigator.languages || [\n    navigator.language,\n    (navigator as any).browserLanguage,\n    (navigator as any).userLanguage,\n    (navigator as any).systemLanguage,\n  ];\n  for (const language of languages) {\n    const locale = language.slice(0, 2);\n    if (availableLanguages.includes(locale)) return locale;\n  }\n  return \"en\";\n}\n\nfunction getLocaleFromUrl() {\n  const url = new URL(window.location.href);\n  return url.searchParams.get(\"iso\");\n}\nexport interface ChangeHandler {\n  (intl?: IntlShape): any;\n}\n\nfunction getValueNamesByDescription(description: string): string[] | undefined {\n  const result = description.match(/{.*?}/g);\n  if (result == null) return;\n  return result.map((x) => x.slice(1, -1));\n}\n\nclass LocaleManager {\n  intl?: IntlShape;\n  emitter = mitt();\n\n  constructor(locale: LangName) {\n    this.toggle(locale);\n  }\n\n  async toggle(locale: LangName) {\n    const { default: messages } = await import(`./lang/${locale}.json`);\n    const cache = createIntlCache();\n    this.intl = createIntl({ locale, messages }, cache);\n    this.emitter.emit(\"change\", this.intl);\n  }\n\n  getLocale(): LangName | undefined {\n    if (!this.intl?.locale) return;\n    return shouldBeLangName(this.intl?.locale);\n  }\n\n  reportMiss<T extends string, M extends string>(\n    description: M & (M extends LangRecodeDescription ? never : {}),\n    id: T & (T extends LangRecordId ? never : {}),\n    values?: Record<string, number | string>\n  ): string {\n    const valueNames = getValueNamesByDescription(description);\n    if (!valueNames) {\n      if (values)\n        console.error(`reportMiss Error: description \"${description}\" does not defined any values, but reportMiss provide values`);\n      return description;\n    }\n    if (!values) {\n      console.error(`reportMiss Error: description \"${description}\" defined values, but reportMiss did not provide values`);\n      return description;\n    }\n    const providedValueNames = Object.keys(values);\n    if (providedValueNames.sort().toString() !== valueNames.sort().toString()) {\n      console.error(\n        `reportMiss Error: description \"${description}\" defined value names: ${valueNames}, but reportMiss provide value names: ${providedValueNames}`\n      );\n    }\n    // let result = description;\n    return providedValueNames.reduce((result, name) => {\n      return result.replace(new RegExp(`\\\\{${name}\\\\}`, \"g\"), String(values[name]));\n    }, description);\n  }\n\n  dscribe<Desc extends LangRecodeDescription>(desc: Desc) {\n    const formatMessage = ((id: any, values: any) => this.formatMessage(id, values)) as FormatMessageByDescription<Desc>;\n    return { t: formatMessage };\n  }\n\n  formatMessage<Id extends LangRecordId>(id: Id, values?: LangeRecordValuesById<Id>): FormatMessageReturn {\n    if (!this.intl) return id;\n    return this.intl.formatMessage({ id }, values);\n  }\n\n  on(event: \"change\", handler: ChangeHandler) {\n    this.emitter.on(\"change\", handler);\n  }\n}\n\nconst defaultLocale = getLocaleFromUrl() || apiLocaleInCookie() || getDefaultLocale(AVAILABLE_LANGUAGES);\nexport const localeManager = new LocaleManager(shouldBeLangName(defaultLocale));\nexport const t = localeManager.formatMessage.bind(localeManager);\nexport const d = localeManager.dscribe.bind(localeManager);\nexport const reportMiss = localeManager.reportMiss.bind(localeManager);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}