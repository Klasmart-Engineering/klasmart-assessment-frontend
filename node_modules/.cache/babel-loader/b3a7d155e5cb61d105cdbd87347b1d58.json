{"ast":null,"code":"import React from\"react\";import{useChoosePermission,useLoadPermission,usePermission}from\"../../hooks/usePermission\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var Permission=function Permission(props){var debug=props.debug,value=props.value,render=props.render,children=props.children;var arr=typeof value===\"object\"?value:[value];var perms=usePermission(arr);var specificPerms=useChoosePermission(perms,arr);var hasPerm=Object.values(specificPerms).every(function(v){return v;});if(debug){}//const perm = usePermission(value);\nif(render)return/*#__PURE__*/_jsx(_Fragment,{children:render(hasPerm)});return hasPerm?/*#__PURE__*/_jsx(_Fragment,{children:children}):null;};var PermissionOr=function PermissionOr(props){var value=props.value,render=props.render,children=props.children;var perms=usePermission(value);var specificPerms=useChoosePermission(perms,value);var hasPerm=Object.values(specificPerms).some(function(v){return v;});if(render)return/*#__PURE__*/_jsx(_Fragment,{children:render(hasPerm)});return hasPerm?/*#__PURE__*/_jsx(_Fragment,{children:children}):null;};/*\n This component is used as a pre load for permissions , to send all children‘s permissions request only once \n*/var PermissionsWrapper=function PermissionsWrapper(_ref){var propsValue=_ref.value,children=_ref.children;//const values: PermissionType[] = propsValue ? propsValue : React.Children.map(children, x => (x as any).props.value) as PermissionType[];\nvar values=[];if(propsValue){values=propsValue;}else{React.Children.forEach(children,function(x){var v=x.props.value;if(typeof v===\"object\"){values.concat(v);}else{values.push(v);}});}var loaded=useLoadPermission(values);return loaded?/*#__PURE__*/_jsx(_Fragment,{children:children}):null;};export{Permission,PermissionOr,PermissionsWrapper};","map":{"version":3,"names":["React","useChoosePermission","useLoadPermission","usePermission","Permission","props","debug","value","render","children","arr","perms","specificPerms","hasPerm","Object","values","every","v","PermissionOr","some","PermissionsWrapper","propsValue","Children","forEach","x","concat","push","loaded"],"sources":["/Users/evik/kl/project-2024/klasmart-assessment-frontend/src/components/Permission/Permission.tsx"],"sourcesContent":["import React, { ReactNode } from \"react\";\nimport PermissionType from \"../../api/PermissionType\";\nimport { useChoosePermission, useLoadPermission, usePermission } from \"../../hooks/usePermission\";\n\nexport type PermissionResult<V> = V extends PermissionType[] ? Record<string | number, boolean> : boolean;\n\nexport interface PermissionProps<V> {\n  debug?: boolean;\n  value: V;\n  render?: (value: boolean) => ReactNode;\n  children?: ReactNode;\n}\nconst Permission = function Permission<V extends PermissionType | PermissionType[]>(props: PermissionProps<V>) {\n  const { debug, value, render, children } = props;\n  const arr = typeof value === \"object\" ? (value as PermissionType[]) : ([value] as PermissionType[]);\n  const perms = usePermission(arr);\n  const specificPerms = useChoosePermission(perms, arr);\n  const hasPerm = Object.values(specificPerms).every((v) => v);\n  if (debug) {\n    console.log(perms, specificPerms, hasPerm);\n  }\n  //const perm = usePermission(value);\n  if (render) return <>{render(hasPerm)}</>;\n\n  return hasPerm ? <>{children}</> : null;\n};\n\nexport interface PermissionOrProps {\n  value: PermissionType[];\n  render?: (value: boolean) => ReactNode;\n  children?: ReactNode;\n}\n\nconst PermissionOr = function PermissionOr(props: PermissionOrProps) {\n  const { value, render, children } = props;\n  const perms = usePermission(value);\n  const specificPerms = useChoosePermission(perms, value);\n  const hasPerm = Object.values(specificPerms).some((v) => v);\n  if (render) return <>{render(hasPerm)}</>;\n  return hasPerm ? <>{children}</> : null;\n};\n\nexport interface PermissionsWrapperProps {\n  value?: PermissionType[];\n  children: React.ReactNode;\n}\n/*\n This component is used as a pre load for permissions , to send all children‘s permissions request only once \n*/\n\nconst PermissionsWrapper = ({ value: propsValue, children }: PermissionsWrapperProps) => {\n  //const values: PermissionType[] = propsValue ? propsValue : React.Children.map(children, x => (x as any).props.value) as PermissionType[];\n  let values: PermissionType[] = [];\n\n  if (propsValue) {\n    values = propsValue;\n  } else {\n    React.Children.forEach(children, (x) => {\n      const v = (x as any).props.value as PermissionType | PermissionType[];\n      if (typeof v === \"object\") {\n        values.concat(v);\n      } else {\n        values.push(v);\n      }\n    });\n  }\n\n  const loaded = useLoadPermission(values);\n  return loaded ? <>{children}</> : null;\n};\n\nexport { Permission, PermissionOr, PermissionsWrapper };\n"],"mappings":"AAAA,MAAOA,CAAAA,KAAP,KAAiC,OAAjC,CAEA,OAASC,mBAAT,CAA8BC,iBAA9B,CAAiDC,aAAjD,KAAsE,2BAAtE,C,gGAUA,GAAMC,CAAAA,UAAU,CAAG,QAASA,CAAAA,UAAT,CAAiEC,KAAjE,CAA4F,CAC7G,GAAQC,CAAAA,KAAR,CAA2CD,KAA3C,CAAQC,KAAR,CAAeC,KAAf,CAA2CF,KAA3C,CAAeE,KAAf,CAAsBC,MAAtB,CAA2CH,KAA3C,CAAsBG,MAAtB,CAA8BC,QAA9B,CAA2CJ,KAA3C,CAA8BI,QAA9B,CACA,GAAMC,CAAAA,GAAG,CAAG,MAAOH,CAAAA,KAAP,GAAiB,QAAjB,CAA6BA,KAA7B,CAA2D,CAACA,KAAD,CAAvE,CACA,GAAMI,CAAAA,KAAK,CAAGR,aAAa,CAACO,GAAD,CAA3B,CACA,GAAME,CAAAA,aAAa,CAAGX,mBAAmB,CAACU,KAAD,CAAQD,GAAR,CAAzC,CACA,GAAMG,CAAAA,OAAO,CAAGC,MAAM,CAACC,MAAP,CAAcH,aAAd,EAA6BI,KAA7B,CAAmC,SAACC,CAAD,QAAOA,CAAAA,CAAP,EAAnC,CAAhB,CACA,GAAIX,KAAJ,CAAW,CAEV,CACD;AACA,GAAIE,MAAJ,CAAY,mBAAO,yBAAGA,MAAM,CAACK,OAAD,CAAT,EAAP,CAEZ,MAAOA,CAAAA,OAAO,cAAG,yBAAGJ,QAAH,EAAH,CAAqB,IAAnC,CACD,CAbD,CAqBA,GAAMS,CAAAA,YAAY,CAAG,QAASA,CAAAA,YAAT,CAAsBb,KAAtB,CAAgD,CACnE,GAAQE,CAAAA,KAAR,CAAoCF,KAApC,CAAQE,KAAR,CAAeC,MAAf,CAAoCH,KAApC,CAAeG,MAAf,CAAuBC,QAAvB,CAAoCJ,KAApC,CAAuBI,QAAvB,CACA,GAAME,CAAAA,KAAK,CAAGR,aAAa,CAACI,KAAD,CAA3B,CACA,GAAMK,CAAAA,aAAa,CAAGX,mBAAmB,CAACU,KAAD,CAAQJ,KAAR,CAAzC,CACA,GAAMM,CAAAA,OAAO,CAAGC,MAAM,CAACC,MAAP,CAAcH,aAAd,EAA6BO,IAA7B,CAAkC,SAACF,CAAD,QAAOA,CAAAA,CAAP,EAAlC,CAAhB,CACA,GAAIT,MAAJ,CAAY,mBAAO,yBAAGA,MAAM,CAACK,OAAD,CAAT,EAAP,CACZ,MAAOA,CAAAA,OAAO,cAAG,yBAAGJ,QAAH,EAAH,CAAqB,IAAnC,CACD,CAPD,CAaA;AACA;AACA,EAEA,GAAMW,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,MAA8D,IAApDC,CAAAA,UAAoD,MAA3Dd,KAA2D,CAAxCE,QAAwC,MAAxCA,QAAwC,CACvF;AACA,GAAIM,CAAAA,MAAwB,CAAG,EAA/B,CAEA,GAAIM,UAAJ,CAAgB,CACdN,MAAM,CAAGM,UAAT,CACD,CAFD,IAEO,CACLrB,KAAK,CAACsB,QAAN,CAAeC,OAAf,CAAuBd,QAAvB,CAAiC,SAACe,CAAD,CAAO,CACtC,GAAMP,CAAAA,CAAC,CAAIO,CAAD,CAAWnB,KAAX,CAAiBE,KAA3B,CACA,GAAI,MAAOU,CAAAA,CAAP,GAAa,QAAjB,CAA2B,CACzBF,MAAM,CAACU,MAAP,CAAcR,CAAd,EACD,CAFD,IAEO,CACLF,MAAM,CAACW,IAAP,CAAYT,CAAZ,EACD,CACF,CAPD,EAQD,CAED,GAAMU,CAAAA,MAAM,CAAGzB,iBAAiB,CAACa,MAAD,CAAhC,CACA,MAAOY,CAAAA,MAAM,cAAG,yBAAGlB,QAAH,EAAH,CAAqB,IAAlC,CACD,CAnBD,CAqBA,OAASL,UAAT,CAAqBc,YAArB,CAAmCE,kBAAnC"},"metadata":{},"sourceType":"module"}