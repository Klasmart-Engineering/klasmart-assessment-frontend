{"ast":null,"code":"import _asyncToGenerator from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/Users/evik/kl/project-2024/klasmart-assessment-frontend/node_modules/@babel/runtime/regenerator/index.js\";import{d}from\"@locale/LocaleManager\";import{actCreateDownload,checkResourceExist}from\"@reducers/assessments\";import{actError}from\"@reducers/notify\";import{unwrapResult}from\"@reduxjs/toolkit\";import React,{useRef}from\"react\";import{useDispatch}from\"react-redux\";import{apiDownloadPageUrl}from\"../../api/extra\";import{jsx as _jsx}from\"react/jsx-runtime\";var createDownloadIframe=function createDownloadIframe(containerRef,src){var _containerRef$current;if(!src)return;var iframe=document.createElement(\"iframe\");iframe.src=src;iframe.style.display=\"none\";(_containerRef$current=containerRef.current)===null||_containerRef$current===void 0?void 0:_containerRef$current.appendChild(iframe);return iframe;};export function DownloadButton(props){var resourceId=props.resourceId,fileName=props.fileName,children=props.children;var btnRef=useRef(null);var dispatch=useDispatch();var hanldeClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _ref2,payload,_yield$dispatch$then,path,pageUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(resourceId){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.next=4;return dispatch(checkResourceExist({resource_id:resourceId,metaLoading:true}));case 4:_ref2=_context.sent;payload=_ref2.payload;if(payload){_context.next=9;break;}dispatch(actError(d(\"This file is not ready. Please try again later.\").t(\"schedule_msg_file_not_ready_to_download\")));return _context.abrupt(\"return\");case 9:_context.next=11;return dispatch(actCreateDownload({resourceId:resourceId,metaLoading:true})).then(unwrapResult);case 11:_yield$dispatch$then=_context.sent;path=_yield$dispatch$then.path;pageUrl=apiDownloadPageUrl(path,fileName);createDownloadIframe(btnRef,pageUrl);case 15:case\"end\":return _context.stop();}}},_callee);}));return function hanldeClick(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"downloadButton\",onClick:hanldeClick,ref:btnRef,children:children});}","map":{"version":3,"names":["d","actCreateDownload","checkResourceExist","actError","unwrapResult","React","useRef","useDispatch","apiDownloadPageUrl","createDownloadIframe","containerRef","src","iframe","document","createElement","style","display","current","appendChild","DownloadButton","props","resourceId","fileName","children","btnRef","dispatch","hanldeClick","e","resource_id","metaLoading","payload","t","then","path","pageUrl"],"sources":["/Users/evik/kl/project-2024/klasmart-assessment-frontend/src/components/DownloadButton/DownloadButton.tsx"],"sourcesContent":["import { d } from \"@locale/LocaleManager\";\nimport { actCreateDownload, checkResourceExist } from \"@reducers/assessments\";\nimport { actError } from \"@reducers/notify\";\nimport { AsyncTrunkReturned } from \"@reducers/type\";\nimport { PayloadAction, unwrapResult } from \"@reduxjs/toolkit\";\nimport React, { DOMAttributes, ReactNode, RefObject, useRef } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { apiDownloadPageUrl } from \"../../api/extra\";\nimport { AppDispatch } from \"../../reducers\";\n\ninterface DownloadButtonProps {\n  resourceId?: string;\n  fileName?: string;\n  children: ReactNode;\n}\n\nconst createDownloadIframe = (containerRef: RefObject<HTMLDivElement>, src?: string) => {\n  if (!src) return;\n  const iframe = document.createElement(\"iframe\");\n  iframe.src = src;\n  iframe.style.display = \"none\";\n  containerRef.current?.appendChild(iframe);\n  return iframe;\n};\n\nexport function DownloadButton(props: DownloadButtonProps) {\n  const { resourceId, fileName, children } = props;\n  const btnRef = useRef<HTMLDivElement>(null);\n  const dispatch = useDispatch<AppDispatch>();\n  const hanldeClick: DOMAttributes<HTMLDivElement>[\"onClick\"] = async (e) => {\n    if (!resourceId) return;\n    const { payload } = (await dispatch(checkResourceExist({ resource_id: resourceId, metaLoading: true }))) as unknown as PayloadAction<\n      AsyncTrunkReturned<typeof checkResourceExist>\n    >;\n    if (!payload) {\n      dispatch(actError(d(\"This file is not ready. Please try again later.\").t(\"schedule_msg_file_not_ready_to_download\")));\n      return;\n    }\n    const { path } = await dispatch(actCreateDownload({ resourceId, metaLoading: true })).then(unwrapResult);\n    const pageUrl = apiDownloadPageUrl(path, fileName);\n    createDownloadIframe(btnRef, pageUrl);\n  };\n  return (\n    <div className=\"downloadButton\" onClick={hanldeClick} ref={btnRef}>\n      {children}\n    </div>\n  );\n}\n"],"mappings":"+RAAA,OAASA,CAAT,KAAkB,uBAAlB,CACA,OAASC,iBAAT,CAA4BC,kBAA5B,KAAsD,uBAAtD,CACA,OAASC,QAAT,KAAyB,kBAAzB,CAEA,OAAwBC,YAAxB,KAA4C,kBAA5C,CACA,MAAOC,CAAAA,KAAP,EAAqDC,MAArD,KAAmE,OAAnE,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,OAASC,kBAAT,KAAmC,iBAAnC,C,2CASA,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACC,YAAD,CAA0CC,GAA1C,CAA2D,2BACtF,GAAI,CAACA,GAAL,CAAU,OACV,GAAMC,CAAAA,MAAM,CAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CACAF,MAAM,CAACD,GAAP,CAAaA,GAAb,CACAC,MAAM,CAACG,KAAP,CAAaC,OAAb,CAAuB,MAAvB,CACA,uBAAAN,YAAY,CAACO,OAAb,sEAAsBC,WAAtB,CAAkCN,MAAlC,EACA,MAAOA,CAAAA,MAAP,CACD,CAPD,CASA,MAAO,SAASO,CAAAA,cAAT,CAAwBC,KAAxB,CAAoD,CACzD,GAAQC,CAAAA,UAAR,CAA2CD,KAA3C,CAAQC,UAAR,CAAoBC,QAApB,CAA2CF,KAA3C,CAAoBE,QAApB,CAA8BC,QAA9B,CAA2CH,KAA3C,CAA8BG,QAA9B,CACA,GAAMC,CAAAA,MAAM,CAAGlB,MAAM,CAAiB,IAAjB,CAArB,CACA,GAAMmB,CAAAA,QAAQ,CAAGlB,WAAW,EAA5B,CACA,GAAMmB,CAAAA,WAAqD,0FAAG,iBAAOC,CAAP,yKACvDN,UADuD,uFAEjCI,CAAAA,QAAQ,CAACvB,kBAAkB,CAAC,CAAE0B,WAAW,CAAEP,UAAf,CAA2BQ,WAAW,CAAE,IAAxC,CAAD,CAAnB,CAFyB,4BAEpDC,OAFoD,OAEpDA,OAFoD,IAKvDA,OALuD,yBAM1DL,QAAQ,CAACtB,QAAQ,CAACH,CAAC,CAAC,iDAAD,CAAD,CAAqD+B,CAArD,CAAuD,yCAAvD,CAAD,CAAT,CAAR,CAN0D,+DASrCN,CAAAA,QAAQ,CAACxB,iBAAiB,CAAC,CAAEoB,UAAU,CAAVA,UAAF,CAAcQ,WAAW,CAAE,IAA3B,CAAD,CAAlB,CAAR,CAA+DG,IAA/D,CAAoE5B,YAApE,CATqC,4CASpD6B,IAToD,sBASpDA,IAToD,CAUtDC,OAVsD,CAU5C1B,kBAAkB,CAACyB,IAAD,CAAOX,QAAP,CAV0B,CAW5Db,oBAAoB,CAACe,MAAD,CAASU,OAAT,CAApB,CAX4D,uDAAH,kBAArDR,CAAAA,WAAqD,4CAA3D,CAaA,mBACE,YAAK,SAAS,CAAC,gBAAf,CAAgC,OAAO,CAAEA,WAAzC,CAAsD,GAAG,CAAEF,MAA3D,UACGD,QADH,EADF,CAKD"},"metadata":{},"sourceType":"module"}