{"ast":null,"code":"import{apiEmitter,ApiEvent}from\"@api/emitter\";import{currentOrganizationState,localeState,useGlobalStateValue}from\"@kl-engineering/frontend-state\";import{shouldBeLangName}from\"@locale/lang/type\";import{localeManager,t}from\"@locale/LocaleManager\";import{setOrganizationId}from\"@reducers/common\";import{store}from\"@reducers/index\";import{actError,actInfo}from\"@reducers/notify\";import React from\"react\";import App from\"./App\";import\"./index.css\";import{jsx as _jsx}from\"react/jsx-runtime\";apiEmitter.on(ApiEvent.ResponseError,function(e){if(!e)return;var label=e.label,msg=e.msg,data=e.data,onError=e.onError;// 韩国方面说： 他们会在容器外部处理未登录， 不需要通知\n// if (label === UNAUTHORIZED_LABEL) sendIframeMessage({ type: 'unauthorized', payload: null });\nvar message=String(t(label,data||undefined)||msg||\"\");if(message)onError?onError(message):store.dispatch(actError(message));});apiEmitter.on(ApiEvent.Info,function(e){if(!e)return;var label=e.label;var message=String(t(label)||\"\");if(message)store.dispatch(actInfo(message));});apiEmitter.on(ApiEvent.GraphQLError,function(e){if(!e)return;var label=e.label,msg=e.msg;var message=String(t(label)||msg||\"\");if(message)store.dispatch(actError(message));});export default function Main(){var locale=useGlobalStateValue(localeState);var currentOrganization=useGlobalStateValue(currentOrganizationState);var organizationId=\"\";if(currentOrganization){var _currentOrganization$;organizationId=(_currentOrganization$=currentOrganization.id)!==null&&_currentOrganization$!==void 0?_currentOrganization$:\"\";}React.useEffect(function(){if(locale)localeManager.toggle(shouldBeLangName(locale.slice(0,2)||\"en\"));if(organizationId)store.dispatch(setOrganizationId(organizationId));},[organizationId,locale]);return/*#__PURE__*/_jsx(App,{});}","map":{"version":3,"names":["apiEmitter","ApiEvent","currentOrganizationState","localeState","useGlobalStateValue","shouldBeLangName","localeManager","t","setOrganizationId","store","actError","actInfo","React","App","on","ResponseError","e","label","msg","data","onError","message","String","undefined","dispatch","Info","GraphQLError","Main","locale","currentOrganization","organizationId","id","useEffect","toggle","slice"],"sources":["/Users/evik/kl/project-2024/klasmart-assessment-frontend/src/main.tsx"],"sourcesContent":["import { apiEmitter, ApiErrorEventData, ApiEvent, ApiInfoEventData, GraphQLErrorEventData } from \"@api/emitter\";\nimport { currentOrganizationState, localeState, useGlobalStateValue } from \"@kl-engineering/frontend-state\";\nimport { LangRecordId, shouldBeLangName } from \"@locale/lang/type\";\nimport { localeManager, t } from \"@locale/LocaleManager\";\nimport { setOrganizationId } from \"@reducers/common\";\nimport { store } from \"@reducers/index\";\nimport { actError, actInfo } from \"@reducers/notify\";\nimport React from \"react\";\nimport App from \"./App\";\nimport \"./index.css\";\n\napiEmitter.on<ApiErrorEventData>(ApiEvent.ResponseError, (e) => {\n  if (!e) return;\n  const { label, msg, data, onError } = e;\n  // 韩国方面说： 他们会在容器外部处理未登录， 不需要通知\n  // if (label === UNAUTHORIZED_LABEL) sendIframeMessage({ type: 'unauthorized', payload: null });\n  const message = String(t(label as LangRecordId, data || undefined) || msg || \"\");\n  if (message) onError ? onError(message) : store.dispatch(actError(message));\n});\n\napiEmitter.on<ApiInfoEventData>(ApiEvent.Info, (e) => {\n  if (!e) return;\n  const { label } = e;\n  const message = String(t(label as LangRecordId) || \"\");\n  if (message) store.dispatch(actInfo(message));\n});\n\napiEmitter.on<GraphQLErrorEventData>(ApiEvent.GraphQLError, (e) => {\n  if (!e) return;\n  const { label, msg } = e;\n  const message = String(t(label as LangRecordId) || msg || \"\");\n  if (message) store.dispatch(actError(message));\n});\n\nexport default function Main() {\n  const locale = useGlobalStateValue(localeState);\n  const currentOrganization = useGlobalStateValue(currentOrganizationState);\n  let organizationId: string = \"\";\n  if(currentOrganization) {\n    organizationId = currentOrganization.id ?? ``;\n  }\n  React.useEffect(() => {\n    if (locale) localeManager.toggle(shouldBeLangName(locale.slice(0, 2) || \"en\"));\n    if (organizationId) store.dispatch(setOrganizationId(organizationId));\n  }, [organizationId, locale]);\n  return <App />;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}