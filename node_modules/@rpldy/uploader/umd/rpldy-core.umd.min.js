/*!
 * MIT License
 * 
 * Copyright (c) 2020 Yoav Niran
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rpldy=e():t.rpldy=e()}(window,(function(){return function(t){function e(e){for(var r,i,u=e[0],c=e[1],l=e[2],d=0,f=[];d<u.length;d++)i=u[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);for(s&&s(e);f.length;)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,u=1;u<n.length;u++){var c=n[u];0!==a[c]&&(r=!1)}r&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},a={core:0},o=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="";var u=window.webpackJsonprpldy=window.webpackJsonprpldy||[],c=u.push.bind(u);u.push=e,u=u.slice();for(var l=0;l<u.length;l++)e(u[l]);var s=c;return o.push([0,"polyfills"]),n()}({0:function(t,e,n){n("9SVt"),n("KkDc"),n("jRAa"),t.exports=n("QELF")},"9SVt":function(t,e,n){"use strict";n.r(e),n.d(e,"addLife",(function(){return it})),n.d(e,"isLE",(function(){return K}));var r=n("04Ix"),a=n.n(r),o=n("RSWj"),i=n.n(o),u=n("HnXd"),c=n.n(u),l=n("M5Mt"),s=n.n(l),d=n("OBge"),f=n.n(d),p=n("FLGM"),g=n.n(p),v=n("5PDf"),h=n.n(v),E=n("kT1S"),S=n.n(E),b=n("eLKs"),m=n.n(b),T=n("+oHS"),A=n.n(T),_=n("zLi2"),R=n.n(_),y=n("i5y0"),I=n.n(y),O=n("KYsz"),L=n.n(O),w=n("STz3"),C=n.n(w),D=n("cdeZ"),F=n.n(D),x=n("UtpJ"),B=n.n(x),N=n("/FZm"),P=n.n(N),H=n("ZbhI"),j=n.n(H),M=n("JlUD"),k=n.n(M),G=n("KkDc"),U=Object(G.devFreeze)({allowRegisterNonExistent:!0,canAddEvents:!0,canRemoveEvents:!0,collectStats:!1}),z=function(t,e){if(!Object(G.isFunction)(t))throw new Error("'".concat(e,"' is not a valid function"))},Q=function(t){return void 0===t},q=n("CtDf"),X=n.n(q)()("__le__"),Z=function(t){return t?t[X]:null},J=function(t){var e=Z(t);if(!e)throw new Error("Didnt find LE internal object. Something very bad happened!");return e},K=function(t){return!!Z(t)},Y=function(t,e,n){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];z(n,"cb");var o=J(t);if(!o.options.allowRegisterNonExistent&&!~j()(r=o.events).call(r,e))throw new Error("Cannot register for event ".concat(e.toString()," that wasn't already defined (allowRegisterNonExistent = false)"));var i={name:e,cb:n,once:a},u=o.registry[e]||[];return P()(u).call(u,(function(t){return t.cb===n}))||(u.push(i),o.registry[e]=u),function(){return at.call(t,e,n)}},W=function(t,e){var n,r,a=J(t).registry;return e?a[e]?B()(n=a[e]).call(n):[]:F()(r=C()(a)).call(r)},V={on:function(t,e){return Y(this,t,e)},once:function(t,e){return Y(this,t,e,!0)},off:at,getEvents:function(){var t;return B()(t=J(this).events).call(t)}},$=function(){var t;return L()(t=I()(V)).call(t,(function(t,e){var n=R()(e,2),r=n[0],a=n[1];return t[r]={value:a},t}),{})},tt={trigger:function(t){for(var e=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o,i,u,c=W(this,t);c.length&&(o=g()(i=h()(u=g()(c).call(c,(function(n){return n.once&&rt(e,t,n.cb),r.length?1===r.length?n.cb(r[0]):2===r.length?n.cb(r[0],r[1]):3===r.length?n.cb(r[0],r[1],r[2]):n.cb.apply(n,r):n.cb()}))).call(u,(function(t){return!Q(t)}))).call(i,(function(t){return k()(t)?t:f.a.resolve(t)})));return o&&(o.length?o:void 0)},addEvent:function(t){var e=J(this);if(!e.options.canAddEvents)throw new Error("Cannot add new events (canAddEvents = false)");var n;if(~j()(n=e.events).call(n,t))throw new Error("Event '".concat(t,"' already defined"));e.events.push(t)},removeEvent:function(t){var e=J(this);if(!e.options.canRemoveEvents)throw new Error("Cannot remove events (canRemoveEvents = false)");var n,r,a=j()(n=e.events).call(n,t);s()(r=e.events).call(r,a,1)},hasEvent:function(t){var e,n=J(this);return!!~j()(e=n.events).call(e,t)},hasEventRegistrations:function(t){return!!W(this,t).length},assign:function(t){var e=J(this);return ot(t,e.options,e.events,e.registry,e.stats),et(t)}},et=function(t){var e;return L()(e=A()(tt)).call(e,(function(e,n){var r;return e[n]=m()(r=tt[n]).call(r,t),e}),S()({target:t},tt))},nt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=J(t).registry;!r[e]||!n&&r[e].length||delete r[e]},rt=function(t,e,n){var r,a=J(t).registry;a[e]&&(n?(a[e]=h()(r=a[e]).call(r,(function(t){return t.cb!==n})),nt(t,e)):nt(t,e,!0))};function at(t,e){rt(this,t,e)}var ot=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};c()(t,S()(a()({},X,{value:i()({registry:r,events:n,options:e,stats:o})}),$()))},it=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;return t=t||{},n=S()(S()({},U),n),K(t)||ot(t,n,e),et(t)};e.default=it},KkDc:function(t,e,n){"use strict";n.r(e),n.d(e,"BATCH_STATES",(function(){return l})),n.d(e,"FILE_STATES",(function(){return s})),n.d(e,"invariant",(function(){return i.a})),n.d(e,"throttle",(function(){return c.a})),n.d(e,"logger",(function(){return r})),n.d(e,"triggerCancellable",(function(){return I})),n.d(e,"triggerUpdater",(function(){return L})),n.d(e,"createBatchItem",(function(){return P})),n.d(e,"request",(function(){return K})),n.d(e,"parseResponseHeaders",(function(){return J})),n.d(e,"isFunction",(function(){return Y})),n.d(e,"isPlainObject",(function(){return lt})),n.d(e,"isSamePropInArrays",(function(){return et})),n.d(e,"devFreeze",(function(){return nt})),n.d(e,"merge",(function(){return pt})),n.d(e,"getMerge",(function(){return ft})),n.d(e,"clone",(function(){return gt})),n.d(e,"pick",(function(){return vt}));var r={};n.r(r),n.d(r,"isDebugOn",(function(){return p})),n.d(r,"setDebug",(function(){return g})),n.d(r,"debugLog",(function(){return v}));var a,o=n("QLaP"),i=n.n(o),u=n("uDTZ"),c=n.n(u),l={ADDED:"added",PROCESSING:"processing",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ABORTED:"aborted"},s={ADDED:"added",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ERROR:"error",ABORTED:"aborted"},d=n("ZbhI"),f=n.n(d),p=function(){var t;"boolean"!=typeof a&&(a=!!~f()(t=window.location.search).call(t,"rpldy_debug=true")||!0===window["__rupy-logger-debug__"]);return a},g=function(t){window["__rupy-logger-debug__"]=t,a=!!t||null},v=function(){var t;p()&&(t=console).log.apply(t,arguments)},h=n("a0dU"),E=n.n(h),S=n("TEMH"),b=n.n(S),m=n("OBge"),T=n.n(m),A=n("o+MX"),_=n.n(A),R=n("SPx3"),y=n.n(R),I=function(t,e){for(var n,r=function(){var e=y()(E.a.mark((function e(n){var r,a,o,i,u,c,l,s=arguments;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=!1,o=s.length,i=new Array(o>1?o-1:0),u=1;u<o;u++)i[u-1]=s[u];if(!(c=t.apply(void 0,_()(r=[n]).call(r,i)))||!c.length){e.next=8;break}return e.next=6,T.a.all(c);case 6:l=e.sent,a=!!~b()(l).call(l,(function(t){return!1===t}));case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a=arguments.length,o=new Array(a>2?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];return e?r.apply(void 0,_()(n=[e]).call(n,o)):r},O=function(t){return null==t},L=function(t,e){for(var n,r=function(){var e=y()(E.a.mark((function e(n){var r,a,o,i,u,c,l,s=arguments;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=s.length,i=new Array(o>1?o-1:0),u=1;u<o;u++)i[u-1]=s[u];if(!(c=t.apply(void 0,_()(r=[n]).call(r,i)))||!c.length){e.next=7;break}return e.next=5,T.a.all(c);case 5:for(l=e.sent;O(a)&&l.length;)a=l.pop();case 7:return e.abrupt("return",O(a)?void 0:a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a=arguments.length,o=new Array(a>2?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];return e?r.apply(void 0,_()(n=[e]).call(n,o)):r},w=n("LYCE"),C=n.n(w),D=n("nhkr"),F=n.n(D),x=n("CtDf"),B=n.n(x)()("__rpldy-bi__"),N=0,P=function(t,e){var n;N+=1;var r={id:t.id?t.id:_()(n="".concat(e,".item-")).call(n,N),batchId:e,state:s.ADDED,completed:0,loaded:0,aborted:!1,recycled:!1};if(C()(r,B,{value:!0,writable:!0}),"object"===F()(t)&&!0===t[B]&&(r.recycled=!0,t=t.file||t.url),"string"==typeof t)r=function(t,e){return t.url=e,t}(r,t);else{if(!function(t){return t&&(t instanceof Blob||t instanceof File||"object"===F()(t)&&t.name&&t.type)}(t))throw new Error("Unknown type of file added: ".concat(F()(t)));r=function(t,e){return t.file=e,t}(r,t)}return r},H=n("+oHS"),j=n.n(H),M=n("RXMP"),k=n.n(M),G=function(t,e){var n;e&&k()(n=j()(e)).call(n,(function(n){void 0!==e[n]&&t.setRequestHeader(n,e[n])}))},U=n("zLi2"),z=n.n(U),Q=n("RKTd"),q=n.n(Q),X=n("KYsz"),Z=n.n(X),J=function(t){var e;try{var n,r;e=Z()(n=q()(r=t.getAllResponseHeaders()).call(r).split(/[\r\n]+/)).call(n,(function(t,e){var n=e.split(": "),r=z()(n,2),a=r[0],o=r[1];return t[a]=o,t}),{})}catch(e){v("uploady.request: failed to read response headers",t)}return e},K=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new XMLHttpRequest,a=new T.a((function(a,o){r.onerror=function(){return o(r)},r.ontimeout=function(){return o(r)},r.onabort=function(){return o(r)},r.onload=function(){return a(r)},r.open(n.method||"GET",t),G(r,n.headers),r.withCredentials=!!n.withCredentials,n.preSend&&n.preSend(r),r.send(e)}));return a.xhr=r,a},Y=function(t){return"function"==typeof t},W=n("/FZm"),V=n.n(W),$=n("FLGM"),tt=n.n($),et=function(t,e,n){var r=!0,a=function(t){var e,n=_()(e=[]).call(e,t);return function(t){return tt()(t).call(t,(function(t){return tt()(n).call(n,(function(e){return t[e]})).join()}))}}(n);if(t&&e&&t.length===e.length){var o=a(t),i=a(e);r=!!V()(o).call(o,(function(t,e){return t!==i[e]}))}return!r},nt=(n("9yv6"),function(t){return t}),rt=n("OWCx"),at=n.n(rt),ot=n("6UaR"),it=n.n(ot),ut=n("zKQ6"),ct=n.n(ut),lt=function(t){var e;return!!t&&"object"===F()(t)&&("Object"===(null===(e=ct()(t))||void 0===e?void 0:e.constructor.name)||null===ct()(t))},st=function(t){return lt(t)||it()(t)},dt=function(t,e){var n=j()(t);return e.withSymbols?_()(n).call(n,at()(t)):n},ft=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=function e(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return n&&a.length&&k()(a).call(a,(function(r){var a;r&&k()(a=dt(r,t)).call(a,(function(a){var o=r[a];(void 0!==o||t.undefinedOverwrites)&&(st(o)?(void 0!==n[a]&&lt(n[a])||(n[a]=it()(o)?[]:{}),e(n[a],o)):n[a]=o)}))})),n};return e},pt=ft(),gt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt;return st(t)?e(it()(t)?[]:{},t):t},vt=function(t,e){var n;return t&&Z()(n=j()(t)).call(n,(function(n,r){return~f()(e).call(e,r)&&(n[r]=t[r]),n}),{})}},QELF:function(t,e,n){"use strict";n.r(e),n.d(e,"UPLOADER_EVENTS",(function(){return q})),n.d(e,"DEFAULT_OPTIONS",(function(){return O})),n.d(e,"composeEnhancers",(function(){return kt})),n.d(e,"createUploader",(function(){return Mt})),n.d(e,"send",(function(){return Bt.send})),n.d(e,"XHR_SENDER_TYPE",(function(){return Bt.XHR_SENDER_TYPE}));var r,a=n("RXMP"),o=n.n(a),i=n("M5Mt"),u=n.n(i),c=n("UtpJ"),l=n.n(c),s=n("a0dU"),d=n.n(s),f=n("o+MX"),p=n.n(f),g=n("SPx3"),v=n.n(g),h=n("STz3"),E=n.n(h),S=n("9SVt"),b=n("KkDc"),m=n("6UaR"),T=n.n(m),A=n("5PDf"),_=n.n(A),R=n("FLGM"),y=n.n(R),I=function(){return!0},O=Object(b.devFreeze)({autoUpload:!0,inputFieldName:"file",concurrent:!1,maxConcurrent:2,grouped:!1,maxGroupSize:5,method:"POST",params:{},fileFilter:I,forceJsonResponse:!1,withCredentials:!1,destination:{},send:null,sendWithFormData:!0}),L=0,w=function(t,e,n){var r;return y()(r=_()(Array.prototype).call(e,n||I)).call(r,(function(e){return Object(b.createBatchItem)(e,t)}))},C=function(t,e,n){var r="batch-".concat(L+=1),a=t instanceof FileList||"[object FileList]"===t.toString();return t=T()(t)||a?t:[t],{id:r,uploaderId:e,items:w(r,t,n.fileFilter),state:b.BATCH_STATES.ADDED,completed:0,loaded:0}},D=n("KYsz"),F=n.n(D),x=n("zLi2"),B=n.n(x),N=n("Vi3r"),P=n.n(N),H=(n("LYCE"),n("+oHS")),j=n.n(H),M=(n("OWCx"),n("ZbhI")),k=n.n(M),G=n("CtDf"),U=n.n(G),z=(Object(b.getMerge)({withSymbols:!0}),U()("__rpldy-sstt-proxy__"),U()("__rpldy-sstt-state__"),function(t,e){0}),Q=function(t){var e=t;return{state:e,update:function(t){try{z(),t(e)}finally{z()}return e},unwrap:function(t){return t||e}}},q=Object(b.devFreeze)({BATCH_ADD:"BATCH-ADD",BATCH_START:"BATCH-START",BATCH_PROGRESS:"BATCH_PROGRESS",BATCH_FINISH:"BATCH-FINISH",BATCH_ABORT:"BATCH-ABORT",BATCH_CANCEL:"BATCH-CANCEL",ITEM_START:"FILE-START",ITEM_CANCEL:"FILE-CANCEL",ITEM_PROGRESS:"FILE-PROGRESS",ITEM_FINISH:"FILE-FINISH",ITEM_ABORT:"FILE-ABORT",ITEM_ERROR:"FILE-ERROR",ITEM_FINALIZE:"FILE-FINALIZE",REQUEST_PRE_SEND:"REQUEST_PRE_SEND"}),X=Object(b.devFreeze)({ITEM_PROGRESS:"ITEM_PROGRESS",BATCH_PROGRESS:"BATCH_PROGRESS"}),Z=n("cdeZ"),J=n.n(Z),K=n("OBge"),Y=n.n(K),W=n("04Ix"),V=n.n(W),$=n("mnMc"),tt=n.n($),et=n("kT1S"),nt=n.n(et),rt=[b.BATCH_STATES.ADDED,b.BATCH_STATES.PROCESSING,b.BATCH_STATES.UPLOADING],at=function(t,e){return t.batches[e].batch},ot=function(t,e,n){return t.getState().items[e].batchId===n},it=function(t,e){var n=t.getState(),r=n.items[e];return n.batches[r.batchId]},ut=function(t,e){return it(t,e).batch},ct=function(t,e){var n,r=function(t,e){return at(t.getState(),e)}(t,e),a=y()(n=r.items).call(n,(function(t){return t.id}));t.updateState((function(t){o()(a).call(a,(function(e){var n;delete t.items[e];var r,a=k()(n=t.itemQueue).call(n,e);~a&&u()(r=t.itemQueue).call(r,a,1)}))}))},lt=function(t,e){t.updateState((function(t){delete t.batches[e]}))},st=function(t,e){var n=ut(t,e),r=n.id;b.logger.debugLog("uploady.uploader.processor: cancelling batch: ",{batch:n}),t.updateState((function(t){at(t,r).state=b.BATCH_STATES.CANCELLED})),gt(t,r,q.BATCH_CANCEL),ct(t,r),lt(t,r)},dt=function(t,e){var n=ut(t,e);return t.getState().currentBatch!==n.id},ft=function(){var t=v()(d.a.mark((function t(e,n){var r,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=ut(e,n),t.next=3,e.cancellable(q.BATCH_START,r);case 3:return(a=t.sent)||e.updateState((function(t){t.currentBatch=r.id})),t.abrupt("return",!a);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),pt=function(t){var e=t.getState().currentBatch;e&&function(t){var e=t.getState().itemQueue;return 0===e.length||dt(t,e[0])}(t)&&(gt(t,e,q.BATCH_FINISH),ct(t,e),lt(t,e))},gt=function(t,e,n){var r,a=t.getState(),o=at(a,e),i=a.items,u=nt()(nt()({},o),{},{items:y()(r=o.items).call(r,(function(t){var e=t.id;return i[e]}))});t.trigger(n,u)},vt=function(t,e){var n=ut(t,e);return tt()(rt).call(rt,n.state)},ht=(r={},V()(r,b.FILE_STATES.ADDED,q.ITEM_START),V()(r,b.FILE_STATES.FINISHED,q.ITEM_FINISH),V()(r,b.FILE_STATES.ERROR,q.ITEM_ERROR),V()(r,b.FILE_STATES.CANCELLED,q.ITEM_CANCEL),V()(r,b.FILE_STATES.ABORTED,q.ITEM_ABORT),V()(r,b.FILE_STATES.UPLOADING,q.ITEM_PROGRESS),r),Et=[b.FILE_STATES.FINISHED,b.FILE_STATES.ERROR,b.FILE_STATES.CANCELLED,b.FILE_STATES.ABORTED],St=function(t){return!!~k()(Et).call(Et,t.state)},bt=function(t,e,n){return o()(e).call(e,(function(e){var n,r=t.getState(),a=e.id,o=e.info;if(b.logger.debugLog("uploader.processor.queue: request finished for item - ",{id:a,info:o}),r.items[a]){t.updateState((function(t){var e=t.items[a];e.state=o.state,e.uploadResponse=o.response,St(e)&&delete t.aborts[a]}));var i=t.getState().items[a];o.state===b.FILE_STATES.FINISHED&&i.completed<100&&t.handleItemProgress(i,100,i.file?i.file.size:0),t.trigger(ht[i.state],i),St(i)&&t.trigger(q.ITEM_FINALIZE,i)}var c=k()(n=r.itemQueue).call(n,a);~c&&t.updateState((function(t){var e,n;u()(e=t.itemQueue).call(e,c,1);var r,o=k()(n=t.activeIds).call(n,a);~o&&u()(r=t.activeIds).call(r,o,1)}))})),pt(t),n(t)},mt=Object(b.getMerge)({undefinedOverwrites:!0}),Tt=function(){var t=v()(d.a.mark((function t(e,n,r){var a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(b.triggerUpdater)(e.trigger,q.REQUEST_PRE_SEND,{items:y()(n).call(n,(function(t){return t})),options:r});case 2:if(!(a=t.sent)){t.next=10;break}if(b.logger.debugLog("uploader.queue: REQUEST_PRE_SEND event returned updated items/options",a),!a.items){t.next=9;break}if(a.items.length===n.length&&Object(b.isSamePropInArrays)(a.items,n,["id","batchId","recycled"])){t.next=8;break}throw new Error("REQUEST_PRE_SEND event handlers must return same items with same ids");case 8:n=a.items;case 9:a.options&&(r=mt({},r,a.options));case 10:return t.abrupt("return",{items:n,options:r,cancelled:!1===a});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),At=function(){var t=v()(d.a.mark((function t(e,n){var r,a,i,u;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=y()(n).call(n,(function(t){return t.id})),e.updateState((function(t){var e;t.activeIds=p()(e=t.activeIds).call(e,r)})),t.next=4,Tt(e,n,e.getState().batches[n[0].batchId].batchOptions);case 4:return(a=t.sent).cancelled||(e.updateState((function(t){var e;o()(e=a.items).call(e,(function(e){t.items[e.id]=e})),t.batches[n[0].batchId].batchOptions=a.options})),u=e.getState(),a.items=y()(i=a.items).call(i,(function(t){return u.items[t.id]})),a.options=u.batches[n[0].batchId].batchOptions),t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),_t=function(t,e,n){t.updateState((function(t){o()(e).call(e,(function(e){t.items[e.id].state=b.FILE_STATES.UPLOADING,t.aborts[e.id]=n.abort}))}))},Rt=function(){var t=v()(d.a.mark((function t(e,n,r){var a,o,i,u,c,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.items,o=n.options,i=e.getState().batches[a[0].batchId].batch,u=e.sender.send(a,i,o),_t(e,a,u),t.next=6,u.request;case 6:c=t.sent,l=y()(a).call(a,(function(t){return{id:t.id,info:c}})),bt(e,l,r);case 9:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),yt=function(t,e,n,r){var a,o=_()(a=y()(n).call(n,(function(t,n){return t?e[n].id:null}))).call(a,Boolean);if(o.length){var i=y()(o).call(o,(function(t){return{id:t,info:{status:0,state:b.FILE_STATES.CANCELLED,response:"cancel"}}}));bt(t,i,r)}return!!o.length},It=function(t,e){return e.getState().items[t]},Ot=function(){var t=v()(d.a.mark((function t(e,n,r){var a,o,i,u,c,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.getState(),i=E()(o.items),i=_()(i).call(i,(function(t){return!!~k()(n).call(n,t.id)})),t.next=5,Y.a.all(y()(i).call(i,(function(t){return e.cancellable(q.ITEM_START,t)})));case 5:if(u=t.sent,!(c=_()(a=y()(u).call(u,(function(t,n){return t?null:It(i[n].id,e)}))).call(a,Boolean)).length){t.next=12;break}return t.next=10,At(e,c);case 10:(l=t.sent).cancelled?u=y()(n).call(n,(function(){return!0})):Rt(e,l,r);case 12:if(yt(e,i,u,r)){t.next=15;break}return t.next=15,r(e);case 15:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),Lt=function(t,e){var n,r;return!!~k()(n=J()(r=t.getState().activeIds).call(r)).call(n,e)},wt=function(t){var e,n=t.getState().itemQueue,r=function(t){for(var e=t.getState(),n=e.itemQueue,r=e.items,a=0,o=n[a];o&&(Lt(t,o)||!vt(t,o)||r[o].state!==b.FILE_STATES.ADDED);)o=n[a+=1];return o?a:-1}(t),a=n[r];if(a){var o=it(t,a),i=o.batch.id,u=o.batchOptions.maxGroupSize||0;if(o.batchOptions.grouped&&u>1){e=[];for(var c=!0;e.length<u&&c;)e.push(a),c=(a=n[r+e.length])&&ot(t,a,i)}else e=[a]}return e},Ct=function(){var t=v()(d.a.mark((function t(e){var n,r,a,o,i,u,c,l,s;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=wt(e))){t.next=13;break}if(r=e.getCurrentActiveCount(),a=e.getOptions(),o=a.concurrent,i=void 0===o?0:o,u=a.maxConcurrent,c=void 0===u?0:u,r&&!(i&&r<c)){t.next=13;break}if(b.logger.debugLog("uploader.processor: Processing next upload - ",{ids:n,state:e.getState(),currentCount:r}),l=!1,!dt(e,n[0])){t.next=12;break}return t.next=9,ft(e,n[0]);case 9:s=t.sent,(l=!s)&&(st(e,n[0]),Ct(e));case 12:l||Ot(e,n,Ct);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Dt=Ct,Ft=function(t,e,n){var r=!1,a=t.getState(),o=a.items[e];return o&&function(t){return t===b.FILE_STATES.ADDED||t===b.FILE_STATES.UPLOADING}(o.state)&&(b.logger.debugLog("uploader.queue: aborting item in progress - ",o),o.state===b.FILE_STATES.UPLOADING?(t.updateState((function(t){t.items[e].state=b.FILE_STATES.ABORTED})),r=a.aborts[e]()):(bt(t,[{id:e,info:{status:0,state:b.FILE_STATES.ABORTED,response:"aborted"}}],n),r=!0)),r},xt=function(t,e,n,r,a){var i=Q({itemQueue:[],currentBatch:null,batches:{},items:{},activeIds:[],aborts:{}}),u=i.state,c=i.update,l=function(t){for(var e,r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return n.apply(void 0,p()(e=[t]).call(e,P()(y()(a).call(a,(function(t){return t})))))},s=function(){return u},d=function(t){c(t)},f=function(t){var e;if(u.items[t.id])throw new Error(p()(e="Uploader queue conflict - item ".concat(t.id," already exists (recycled: ")).call(e,String(t.recycled),")"));d((function(e){e.items[t.id]=t,e.itemQueue.push(t.id)}))},g=function(t,e,n){u.items[t.id]&&(d((function(r){var a=r.items[t.id];a.loaded=n,a.completed=e})),l(q.ITEM_PROGRESS,s().items[t.id]))};r.on(X.ITEM_PROGRESS,g),r.on(X.BATCH_PROGRESS,(function(t){var e,n=null===(e=u.batches[t.id])||void 0===e?void 0:e.batch.items;if(n){var r=F()(n).call(n,(function(t,e){return t[0]+=e.completed,t[1]+=e.loaded,t}),[0,0]),a=B()(r,2),o=a[0],i=a[1];d((function(e){var r=e.batches[t.id].batch;r.completed=o/n.length,r.loaded=i})),l(q.BATCH_PROGRESS,u.batches[t.id].batch)}}));var v={getOptions:function(){return t},getCurrentActiveCount:function(){return u.activeIds.length},getState:s,updateState:d,trigger:l,cancellable:function(t){for(var n,r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return e.apply(void 0,p()(n=[t]).call(n,P()(y()(a).call(a,(function(t){return t})))))},sender:r,handleItemProgress:g};b.logger.isDebugOn()&&(window["__rpldy_".concat(a,"_queue_state")]=v);return{updateState:d,getState:v.getState,uploadBatch:function(t,e){var n;d((function(n){n.batches[t.id]={batch:t,batchOptions:e}})),o()(n=t.items).call(n,f),Dt(v)},abortItem:function(t){return function(t,e,n){return Ft(t,e,n)}(v,t,Dt)},abortBatch:function(t){!function(t,e,n){var r,a=t.getState().batches[e],i=null==a?void 0:a.batch;i&&i.state!==b.BATCH_STATES.CANCELLED&&i.state!==b.BATCH_STATES.FINISHED&&(o()(r=i.items).call(r,(function(e){return Ft(t,e.id,n)})),t.updateState((function(t){at(t,e).state=b.BATCH_STATES.ABORTED})),gt(t,e,q.BATCH_ABORT))}(v,t,Dt)},abortAll:function(){var t,e,n,r;e=Dt,r=(t=v).getState().items,o()(n=j()(r)).call(n,(function(n){return Ft(t,n,e)}))}}},Bt=n("jRAa"),Nt=function(t,e,n,r){!function(t,e,n,r){o()(t).call(t,(function(t){var a,o;b.logger.debugLog(p()(a=p()(o="uploady.uploader.processor: file: ".concat(t.id," progress event: loaded(")).call(o,n,") - completed(")).call(a,e,")")),r(X.ITEM_PROGRESS,t,e,n)}))}(t,Math.min(n.loaded/n.total*100,100)/t.length,n.loaded/t.length,r),r(X.BATCH_PROGRESS,e)},Pt=function(t,e,n){var r=Object(b.triggerCancellable)(t),a=function(){var t=Object(S.default)({send:function(t,n,r){var a=r.destination,o=null==a?void 0:a.url;if(!o)throw new Error("Destination URL not found! Can't send files without it");var i=Object(b.throttle)((function(r){return Nt(t,n,r,e)}),50,!0),u=Object(b.isFunction)(r.send)?r.send:Bt.default;return u(t,o,{method:(null==a?void 0:a.method)||r.method||O.method,paramName:(null==a?void 0:a.filesParamName)||r.inputFieldName||"file",params:nt()(nt()({},r.params),null==a?void 0:a.params),forceJsonResponse:r.forceJsonResponse,withCredentials:r.withCredentials,formatGroupParamName:r.formatGroupParamName,headers:null==a?void 0:a.headers,sendWithFormData:r.sendWithFormData},i)}},E()(X)),e=t.trigger;return t.target}(),o=xt(e,r,t,a,n);return{process:function(t,e){o.uploadBatch(t,e)},abortBatch:function(t){o.abortBatch(t)},abort:function(t){t?o.abortItem(t):o.abortAll()}}},Ht=E()(q),jt=0,Mt=function(t){var e="uploader-".concat(jt+=1),n=!1,r=[],a={};b.logger.debugLog("uploady.uploader: creating new instance (".concat(e,")"),{options:t,counter:jt});var i=function(t){return nt()(nt()(nt()({},O),t),{},{destination:t&&t.destination?(e=t.destination,nt()({filesParamName:"file",params:{}},e)):null});var e}(t),c=function(){var t=v()(d.a.mark((function t(e,n){var a,o,u;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object(b.merge)({},i,n),!(o=C(e,g.id,a)).items.length){t.next=9;break}return t.next=5,h(q.BATCH_ADD,o,a);case 5:t.sent?(o.state=b.BATCH_STATES.CANCELLED,f(q.BATCH_CANCEL,o)):(b.logger.debugLog(p()(u="uploady.uploader [".concat(g.id,"]: new items added - auto upload = ")).call(u,String(a.autoUpload)),o.items),a.autoUpload?m.process(o,a):r.push({batch:o,uploadOptions:a})),t.next=10;break;case 9:b.logger.debugLog("uploady.uploader: no items to add. batch ".concat(o.id," is empty. check fileFilter if this isn't intended"));case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),s=Object(S.default)({id:e,update:function(t){return i=Object(b.merge)({},i,t),g},add:c,upload:function(){var t;o()(t=u()(r).call(r,0)).call(t,(function(t){var e=t.batch,n=t.uploadOptions;return m.process(e,n)}))},abort:function(t){m.abort(t)},abortBatch:function(t){m.abortBatch(t)},getOptions:function(){return Object(b.clone)(i)},getPending:function(){return l()(r).call(r)},clearPending:function(){u()(r).call(r,0)},registerExtension:function(t,e){Object(b.invariant)(n,"Uploady - uploader extensions can only be registered by enhancers"),Object(b.invariant)(!a[t],"Uploady - uploader extension by this name [%s] already exists",t),b.logger.debugLog("uploady.uploader: registering extension: ".concat(t.toString()),e),a[t]=e},getExtension:function(t){return a[t]}},Ht,{canAddEvents:!1,canRemoveEvents:!1}),f=s.trigger,g=s.target,h=Object(b.triggerCancellable)(f);if(i.enhancer){n=!0;var E=i.enhancer(g,f);n=!1,g=E||g}var m=Pt(f,i,g.id);return Object(b.devFreeze)(g)},kt=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return F()(e).call(e,(function(t,e){var n;return e.apply(void 0,p()(n=[t]).call(n,r))||t}),t)}};e.default=Mt},jRAa:function(t,e,n){"use strict";n.r(e),n.d(e,"send",(function(){return L})),n.d(e,"XHR_SENDER_TYPE",(function(){return h}));var r=n("o+MX"),a=n.n(r),o=n("a0dU"),i=n.n(o),u=n("SPx3"),c=n.n(u),l=n("ZbhI"),s=n.n(l),d=n("UtpJ"),f=n.n(d),p=n("kT1S"),g=n.n(p),v=n("KkDc"),h="rpldy-sender",E=n("zLi2"),S=n.n(E),b=n("i5y0"),m=n.n(b),T=n("RXMP"),A=n.n(T),_=function(t,e){var n,r=new FormData;(function(t,e,n){var r=1===e.length;A()(e).call(e,(function(e,o){var i,u=r?n.paramName:Object(v.isFunction)(n.formatGroupParamName)?n.formatGroupParamName(o,n.paramName):a()(i="".concat(n.paramName,"[")).call(i,o,"]");e.file?t.set(u,e.file,e.file.name):e.url&&t.set(u,e.url)}))}(r,t,e),e.params)&&A()(n=m()(e.params)).call(n,(function(t){var e=S()(t,2),n=e[0],a=e[1];return r.set(n,a)}));return r},R=[200,201,202,203,204],y=function(t,e,n,r){var a=function(t,e){var n;if(e.sendWithFormData)v.logger.debugLog("uploady.sender: sending ".concat(t.length," item(s) as form data")),n=_(t,e);else{if(t.length>1)throw new Error("XHR Sender - Request without form data can only contain 1 item. received ".concat(t.length));var r=t[0];v.logger.debugLog("uploady.sender: sending item ".concat(r.id," as request body")),n=r.file||r.url}return n}(t,n),o=Object(v.request)(e,a,g()(g()({},Object(v.pick)(n,["method","headers","withCredentials"])),{},{preSend:function(e){e.upload.onprogress=function(e){e.lengthComputable&&r&&r(e,f()(t).call(t))}}}));return{url:e,count:t.length,pXhr:o,xhr:o.xhr,aborted:!1}},I=function(t,e,n){var r=t,a=e&&e["content-type"];if(n.forceJsonResponse||a&&~s()(a).call(a,"json"))try{r=JSON.parse(t)}catch(t){}return r},O=function(){var t=c()(i.a.mark((function t(e,n){var r,a,o,u,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=0,t.prev=1,t.next=4,e.pXhr;case 4:u=t.sent,v.logger.debugLog("uploady.sender: received upload response ",u),r=~s()(R).call(R,u.status)?v.FILE_STATES.FINISHED:v.FILE_STATES.ERROR,o=u.status,c=Object(v.parseResponseHeaders)(u),a={data:I(u.response,c,n),headers:c},t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),e.aborted?(r=v.FILE_STATES.ABORTED,a="aborted"):(v.logger.debugLog("uploady.sender: upload failed: ",t.t0),r=v.FILE_STATES.ERROR,a=t.t0);case 15:return t.abrupt("return",{status:o,state:r,response:a});case 16:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e,n){return t.apply(this,arguments)}}(),L=function(t,e,n,r){v.logger.debugLog("uploady.sender: sending file: ",{items:t,url:e,options:n});var o=y(t,e,n,r);return{request:O(o,n),abort:function(){return function(t){var e,n=!1,r=t.aborted,o=t.xhr;!r&&o.readyState&&4!==o.readyState&&(v.logger.debugLog(a()(e="uploady.sender: cancelling request with ".concat(t.count," items to: ")).call(e,t.url)),o.abort(),t.aborted=!0,n=!0);return n}(o)},senderType:h}};e.default=L}})}));
//# sourceMappingURL=rpldy-core.umd.min.js.map